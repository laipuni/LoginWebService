<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <title>Title</title>
</head>
<body>
    <main>
        <div class="container w-25">
            <h2 class="text-center mb-3">하고싶은 말을 적어주세요!</h2>
            <span style="font-size: 0.7rem">ver1.0.0</span>
            <div id="inputError"></div>
            <form class="input-group mp-3">
                <input type="text" class="form-control" id="content" placeholder="input...">
                <button type="submit" class="btn btn-primary" th:text="#{label.submit}">submit</button>
            </form>
            <div id="inputResultDiv"></div>
        </div>
    </main>

    <script th:inline="javascript">
        $(window).on('load',()=>{
            $.get("/content")
                .done((result)=>{
                    if(result.status.match("OK")){
                        $.each(result.data.contents,(index,content)=>{
                            const contentDiv = `
                                    <div id="content${content.contentId}">
                                            <b>${content.contents}</b>
                                            <p style="font-size: 0.6rem">${content.createDate}</p>
                                    </div>
                                    `
                            $("#inputResultDiv").append(contentDiv)
                        })
                    } else{
                        alert("알 수 없는 에러가 발생했습니다.")
                        $("#inputError").text(result.message)
                    }
                })
                .fail((error)=>{
                    console.log(JSON.stringify(error))
                })
        })

        $(document).on('submit','form', (event) => {
            event.preventDefault()
            const content = $('#content').val();
            $.ajax({
                url:'/content',
                type:'post',
                contentType:'application/json',
                data:JSON.stringify(content)
            })
                .done(function (result){
                    if(result.status.match("CREATED")){
                        $("#inputError").text("")
                        $("input").val("")
                        const contentDiv = `
                                    <div id="content${result.data.contentId}">
                                            <b>${result.data.contents}</b>
                                            <p style="font-size: 0.6rem">${result.data.createDate}</p>
                                    </div>
                                    `
                        $("#inputResultDiv").prepend(contentDiv)
                    } else{
                        $("#inputError").text(result.message)
                    }
                })
                .fail((error) => {
                    console.log("fail" + JSON.stringify(error.responseJSON))
                    $("#inputError").text(error.responseJSON.message)
                })
        })

        $(document).on('animationend',"#inputResultDiv",()=>{
            $("#inputResultDiv").removeClass("isAnimate")
        })
    </script>
</body>
</html>